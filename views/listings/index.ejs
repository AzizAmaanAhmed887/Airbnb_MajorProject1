<% layout("/layouts/boilerplate.ejs") %>
<div class="container-fluid px-4 py-4">
  <!-- Header Section -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="display-5 fw-bold mb-1">Discover Amazing Places</h1>
      <p class="text-muted">
        Find your perfect stay from <%= allListings.length %> listings
      </p>
    </div>
  </div>

  <!-- Listings Grid -->
  <div
    class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-5 g-4 mb-4"
  >
    <% for(let listing of allListings) { %>
    <div class="col">
      <a
        href="/listings/<%= listing._id %>"
        class="listing-link text-decoration-none"
      >
        <div
          class="card h-100 border-0 shadow-sm listing-card position-relative"
        >
          <!-- Wishlist Button -->
          <button
            class="btn btn-sm position-absolute top-0 end-0 m-3 wishlist-btn bg-white rounded-circle p-2 border-0 shadow-sm"
            onclick="event.preventDefault();"
          >
            <i class="bi bi-heart text-danger"></i>
          </button>

          <!-- Image Container -->
          <div
            class="position-relative overflow-hidden listing-image-container"
          >
            <img
              src="<%= listing.image.url %>"
              class="card-img-top listing-image"
              alt="<%= listing.title %>"
              loading="lazy"
            />
            <!-- Badges -->
            <div class="position-absolute top-0 start-0 m-3">
              <span class="badge bg-success mb-1">Available</span>
            </div>
            <div
              class="position-absolute bottom-0 start-0 end-0 p-3 listing-overlay"
            >
              <div class="d-flex gap-2">
                <span class="badge bg-white text-dark">
                  <i class="bi bi-star-fill text-warning"></i> 4.8
                </span>
                <span class="badge bg-white text-dark">
                  <i class="bi bi-eye-fill"></i> 120 views
                </span>
              </div>
            </div>
          </div>

          <!-- Card Body -->
          <div class="card-body">
            <h5
              class="card-title fw-bold mb-2 text-dark"
              style="font-size: 1rem"
            >
              <%= listing.title %>
            </h5>

            <p class="card-text text-muted small mb-2">
              <i class="bi bi-geo-alt-fill text-primary"></i>
              <%= listing.location || 'Location not specified' %>
            </p>

            <!-- Amenities/Features -->
            <div class="d-flex gap-3 mb-3 text-muted small">
              <span><i class="bi bi-person-fill"></i> 4 guests</span>
              <span><i class="bi bi-door-open-fill"></i> 2 beds</span>
              <span><i class="bi bi-droplet-fill"></i> 1 bath</span>
            </div>

            <!-- Divider -->
            <hr class="my-2" />

            <!-- Price Section -->
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <span class="text-dark fw-bold fs-5">
                  â‚¹<%= listing.price ? listing.price.toLocaleString("en-IN") :
                  "N/A" %>
                </span>
                <span class="text-muted small d-block">per night</span>
              </div>
              <a
                href="/listings/<%= listing._id %>/book"
                class="btn btn-sm btn-primary"
                onclick="event.stopPropagation();"
              >
                Book Now
              </a>
            </div>
          </div>

          <!-- Hover Effect Indicator -->
          <div class="card-footer bg-transparent border-0 pt-0">
            <small class="text-muted">
              <i class="bi bi-calendar-check"></i> Free cancellation
            </small>
          </div>
        </div>
      </a>
    </div>
    <% } %>
  </div>

  <!-- Empty State -->
  <% if(allListings.length === 0) { %>
  <div class="text-center py-5">
    <div class="mb-4">
      <i class="bi bi-house-x display-1 text-muted"></i>
    </div>
    <h3 class="mb-3">No Listings Found</h3>
    <p class="text-muted mb-4">
      We couldn't find any listings matching your criteria.
    </p>
    <button class="btn btn-primary">
      <i class="bi bi-arrow-clockwise"></i> Reset Filters
    </button>
  </div>
  <% } %>
</div>

<style>
  /* Card Animations */
  .listing-card {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border-radius: 16px;
    overflow: hidden;
  }

  .listing-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15) !important;
  }

  /* Image Styling */
  .listing-image-container {
    height: 240px;
    background: #f8f9fa;
  }

  .listing-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.4s ease;
  }

  .listing-card:hover .listing-image {
    transform: scale(1.08);
  }

  /* Overlay Effects */
  .listing-overlay {
    background: linear-gradient(to top, rgba(0, 0, 0, 0.6), transparent);
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .listing-card:hover .listing-overlay {
    opacity: 1;
  }

  /* Wishlist Button */
  .wishlist-btn {
    z-index: 10;
    transition: all 0.2s ease;
  }

  .wishlist-btn:hover {
    transform: scale(1.1);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }

  .wishlist-btn:active {
    transform: scale(0.95);
  }

  /* Link Styling */
  .listing-link {
    color: inherit;
  }

  .listing-link:hover {
    color: inherit;
  }

  /* Card Title Truncation */
  .card-title {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
    min-height: 2.4em;
  }

  /* Badge Styling */
  .badge {
    font-weight: 500;
    padding: 0.4rem 0.7rem;
  }

  /* Search Input Focus */
  .form-control:focus,
  .form-select:focus {
    border-color: #0d6efd;
    box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.15);
  }

  /* Button Group */
  .btn-group .btn.active {
    background-color: #0d6efd;
    color: white;
    border-color: #0d6efd;
  }

  /* Responsive Adjustments */
  @media (max-width: 768px) {
    .listing-image-container {
      height: 200px;
    }

    .display-5 {
      font-size: 1.8rem;
    }
  }

  /* Loading Skeleton (Optional) */
  @keyframes shimmer {
    0% {
      background-position: -468px 0;
    }
    100% {
      background-position: 468px 0;
    }
  }

  .skeleton {
    animation: shimmer 1.2s ease-in-out infinite;
    background: linear-gradient(
      to right,
      #f6f7f8 0%,
      #edeef1 20%,
      #f6f7f8 40%,
      #f6f7f8 100%
    );
    background-size: 800px 104px;
  }

  .card-body {
    padding: 0.5rem 0.5rem 0.5rem 1rem !important;
  }

  .listing-card .card-body {
    padding: 1rem 1rem 0.5rem 1rem !important;
  }
</style>

<script>
  // Add to favorite functionality
  document.querySelectorAll(".wishlist-btn").forEach((btn) => {
    btn.addEventListener("click", function (e) {
      e.preventDefault();
      e.stopPropagation();
      const icon = this.querySelector("i");
      icon.classList.toggle("bi-heart");
      icon.classList.toggle("bi-heart-fill");
    });
  });

  // Search functionality (example)
  const searchInput = document.querySelector(
    'input[placeholder="Search listings..."]'
  );
  if (searchInput) {
    searchInput.addEventListener("input", function (e) {
      // Add your search logic here
      console.log("Searching for:", e.target.value);
    });
  }
</script>

